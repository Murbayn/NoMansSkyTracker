<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://unpkg.com https://cdn.tailwindcss.com 'sha256-CU75rgQjQ715qGuQqja19ufDyVmGB5kGGAO4K2ZJKag='; style-src 'self' https://cdn.tailwindcss.com 'unsafe-inline'; connect-src 'self' https://unpkg.com;">
  <title>No Man's Sky Tracker</title>
  <script src="https://unpkg.com/react@18.2.0/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone@7.22.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white">
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;

    const App = () => {
      const [systems, setSystems] = useState([]);
      const [showModal, setShowModal] = useState(false);
      const [currentSystem, setCurrentSystem] = useState(null);
      const [search, setSearch] = useState('');
      const [filter, setFilter] = useState({ race: '', economy: '', conflict: '', pirate: '', dissonant: '' });

      useEffect(() => {
        const savedSystems = localStorage.getItem('nms_systems');
        if (savedSystems) setSystems(JSON.parse(savedSystems));
      }, []);

      useEffect(() => {
        localStorage.setItem('nms_systems', JSON.stringify(systems));
      }, [systems]);

      const addSystem = (system) => {
        setSystems([...systems, { ...system, id: Date.now(), planets: [] }]);
        setShowModal(false);
      };

      const updateSystem = (updatedSystem) => {
        setSystems(systems.map(s => s.id === updatedSystem.id ? updatedSystem : s));
        setShowModal(false);
      };

      const deleteSystem = (id) => {
        setSystems(systems.filter(s => s.id !== id));
      };

      const addPlanet = (systemId, planet) => {
        setSystems(systems.map(s => 
          s.id === systemId ? { ...s, planets: [...s.planets, { ...planet, id: Date.now() }] } : s
        ));
      };

      const updatePlanet = (systemId, updatedPlanet) => {
        setSystems(systems.map(s => 
          s.id === systemId ? { 
            ...s, 
            planets: s.planets.map(p => p.id === updatedPlanet.id ? updatedPlanet : p)
          } : s
        ));
      };

      const deletePlanet = (systemId, planetId) => {
        setSystems(systems.map(s => 
          s.id === systemId ? { ...s, planets: s.planets.filter(p => p.id !== planetId) } : s
        ));
      };

      const filteredSystems = systems.filter(s => 
        s.name.toLowerCase().includes(search.toLowerCase()) &&
        (filter.race ? s.race === filter.race : true) &&
        (filter.economy ? s.economy === filter.economy : true) &&
        (filter.conflict ? s.conflict === filter.conflict : true) &&
        (filter.pirate ? s.pirate === filter.pirate : true) &&
        (filter.dissonant ? s.dissonant === filter.dissonant : true)
      );

      return (
        <div className="container mx-auto p-4">
          <h1 className="text-3xl font-bold mb-4">No Man's Sky Tracker</h1>
          
          <div className="mb-4 flex flex-wrap gap-4">
            <input 
              type="text" 
              placeholder="Search systems..." 
              className="p-2 rounded bg-gray-800 text-white"
              value={search}
              onChange={(e) => setSearch(e.target.value)}
            />
            <select 
              className="p-2 rounded bg-gray-800 text-white"
              onChange={(e) => setFilter({ ...filter, race: e.target.value })}
            >
              <option value="">All Races</option>
              <option value="Gek">Gek</option>
              <option value="Korvax">Korvax</option>
              <option value="Vy'keen">Vy'keen</option>
            </select>
            <select 
              className="p-2 rounded bg-gray-800 text-white"
              onChange={(e) => setFilter({ ...filter, economy: e.target.value })}
            >
              <option value="">All Economies</option>
              <option value="Advanced">Advanced</option>
              <option value="Balanced">Balanced</option>
              <option value="Declining">Declining</option>
            </select>
            <select 
              className="p-2 rounded bg-gray-800 text-white"
              onChange={(e) => setFilter({ ...filter, conflict: e.target.value })}
            >
              <option value="">All Conflicts</option>
              <option value="Low">Low</option>
              <option value="Medium">Medium</option>
              <option value="High">High</option>
            </select>
            <select 
              className="p-2 rounded bg-gray-800 text-white"
              onChange={(e) => setFilter({ ...filter, pirate: e.target.value })}
            >
              <option value="">Pirate?</option>
              <option value="Yes">Yes</option>
              <option value="No">No</option>
            </select>
            <select 
              className="p-2 rounded bg-gray-800 text-white"
              onChange={(e) => setFilter({ ...filter, dissonant: e.target.value })}
            >
              <option value="">Dissonant?</option>
              <option value="Yes">Yes</option>
              <option value="No">No</option>
            </select>
          </div>

          <button 
            className="bg-blue-600 hover:bg-blue-700 text-white p-2 rounded mb-4"
            onClick={() => { setCurrentSystem(null); setShowModal(true); }}
          >
            Add System
          </button>

          {filteredSystems.map(system => (
            <SystemCard 
              key={system.id} 
              system={system} 
              onEdit={() => { setCurrentSystem(system); setShowModal(true); }}
              onDelete={() => deleteSystem(system.id)}
              onAddPlanet={addPlanet}
              onUpdatePlanet={updatePlanet}
              onDeletePlanet={deletePlanet}
            />
          ))}

          {showModal && (
            <SystemModal 
              system={currentSystem} 
              onSave={currentSystem ? updateSystem : addSystem} 
              onClose={() => setShowModal(false)} 
            />
          )}
        </div>
      );
    };

    const SystemCard = ({ system, onEdit, onDelete, onAddPlanet, onUpdatePlanet, onDeletePlanet }) => {
      const [showPlanets, setShowPlanets] = useState(false);
      const [showPlanetModal, setShowPlanetModal] = useState(false);
      const [currentPlanet, setCurrentPlanet] = useState(null);

      return (
        <div className="bg-gray-800 p-4 rounded mb-4">
          <div className="flex justify-between">
            <h2 className="text-xl font-bold">{system.name}</h2>
            <div>
              <button 
                className="text-blue-400 mr-2"
                onClick={onEdit}
              >
                Edit
              </button>
              <button 
                className="text-red-400"
                onClick={onDelete}
              >
                Delete
              </button>
            </div>
          </div>
          <p>Race: {system.race}</p>
          <p>Economy: {system.economy} ({system.economyRating} stars)</p>
          <p>Conflict: {system.conflict}</p>
          <p>Pirate: {system.pirate}</p>
          <p>Dissonant: {system.dissonant}</p>
          <p>Coordinates: {system.coordinates}</p>
          <p>Glyphs: {system.glyphs}</p>
          <p>Notes: {system.notes}</p>
          <button 
            className="text-blue-400 mt-2"
            onClick={() => setShowPlanets(!showPlanets)}
          >
            {showPlanets ? 'Hide Planets' : 'Show Planets'}
          </button>
          <button 
            className="text-green-400 mt-2 ml-4"
            onClick={() => { setCurrentPlanet(null); setShowPlanetModal(true); }}
          >
            Add Planet
          </button>
          {showPlanets && (
            <div className="mt-4">
              {system.planets.map(planet => (
                <div key={planet.id} className="bg-gray-700 p-2 rounded mt-2">
                  <h3 className="text-lg font-bold">{planet.name}</h3>
                  <p>Type: {planet.type}</p>
                  <p>Resources: {planet.resources}</p>
                  <p>Sentinel: {planet.sentinel}</p>
                  <p>Weather: {planet.weather}</p>
                  <p>Outpost: {planet.outpost}</p>
                  <p>Notes: {planet.notes}</p>
                  <button 
                    className="text-blue-400 mr-2"
                    onClick={() => { setCurrentPlanet(planet); setShowPlanetModal(true); }}
                  >
                    Edit
                  </button>
                  <button 
                    className="text-red-400"
                    onClick={() => onDeletePlanet(system.id, planet.id)}
                  >
                    Delete
                  </button>
                </div>
              ))}
            </div>
          )}
          {showPlanetModal && (
            <PlanetModal 
              planet={currentPlanet} 
              onSave={(planet) => {
                currentPlanet ? onUpdatePlanet(system.id, planet) : onAddPlanet(system.id, planet);
                setShowPlanetModal(false);
              }} 
              onClose={() => setShowPlanetModal(false)} 
            />
          )}
        </div>
      );
    };

    const SystemModal = ({ system, onSave, onClose }) => {
      const [form, setForm] = useState(system || {
        name: '', race: '', economy: '', economyRating: '1', conflict: '', 
        pirate: 'No', dissonant: 'No', coordinates: '', glyphs: '', notes: ''
      });

      const handleSubmit = (e) => {
        e.preventDefault();
        onSave({ ...form, id: system?.id });
      };

      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center">
          <div className="bg-gray-800 p-6 rounded w-full max-w-md">
            <h2 className="text-xl font-bold mb-4">{system ? 'Edit System' : 'Add System'}</h2>
            <form onSubmit={handleSubmit}>
              <input 
                type="text" 
                placeholder="System Name" 
                className="w-full p-2 mb-2 rounded bg-gray-700 text-white"
                value={form.name}
                onChange={(e) => setForm({ ...form, name: e.target.value })}
                required
              />
              <select 
                className="w-full p-2 mb-2 rounded bg-gray-700 text-white"
                value={form.race}
                onChange={(e) => setForm({ ...form, race: e.target.value })}
                required
              >
                <option value="">Select Race</option>
                <option value="Gek">Gek</option>
                <option value="Korvax">Korvax</option>
                <option value="Vy'keen">Vy'keen</option>
              </select>
              <select 
                className="w-full p-2 mb-2 rounded bg-gray-700 text-white"
                value={form.economy}
                onChange={(e) => setForm({ ...form, economy: e.target.value })}
                required
              >
                <option value="">Select Economy</option>
                <option value="Advanced">Advanced</option>
                <option value="Balanced">Balanced</option>
                <option value="Declining">Declining</option>
              </select>
              <select 
                className="w-full p-2 mb-2 rounded bg-gray-700 text-white"
                value={form.economyRating}
                onChange={(e) => setForm({ ...form, economyRating: e.target.value })}
                required
              >
                <option value="1">1 Star</option>
                <option value="2">2 Stars</option>
                <option value="3">3 Stars</option>
              </select>
              <select 
                className="w-full p-2 mb-2 rounded bg-gray-700 text-white"
                value={form.conflict}
                onChange={(e) => setForm({ ...form, conflict: e.target.value })}
                required
              >
                <option value="">Select Conflict</option>
                <option value="Low">Low</option>
                <option value="Medium">Medium</option>
                <option value="High">High</option>
              </select>
              <select 
                className="w-full p-2 mb-2 rounded bg-gray-700 text-white"
                value={form.pirate}
                onChange={(e) => setForm({ ...form, pirate: e.target.value })}
              >
                <option value="No">No</option>
                <option value="Yes">Yes</option>
              </select>
              <select 
                className="w-full p-2 mb-2 rounded bg-gray-700 text-white"
                value={form.dissonant}
                onChange={(e) => setForm({ ...form, dissonant: e.target.value })}
              >
                <option value="No">No</option>
                <option value="Yes">Yes</option>
              </select>
              <input 
                type="text" 
                placeholder="Coordinates (e.g., 0800:007F:07FF:0000)" 
                className="w-full p-2 mb-2 rounded bg-gray-700 text-white"
                value={form.coordinates}
                onChange={(e) => setForm({ ...form, coordinates: e.target.value })}
                required
              />
              <input 
                type="text" 
                placeholder="Glyphs (e.g., 1234567890AB)" 
                className="w-full p-2 mb-2 rounded bg-gray-700 text-white"
                value={form.glyphs}
                onChange={(e) => setForm({ ...form, glyphs: e.target.value })}
              />
              <textarea 
                placeholder="Notes" 
                className="w-full p-2 mb-2 rounded bg-gray-700 text-white"
                value={form.notes}
                onChange={(e) => setForm({ ...form, notes: e.target.value })}
              />
              <div className="flex justify-end">
                <button 
                  type="button" 
                  className="bg-gray-600 hover:bg-gray-700 text-white p-2 rounded mr-2"
                  onClick={onClose}
                >
                  Cancel
                </button>
                <button 
                  type="submit" 
                  className="bg-blue-600 hover:bg-blue-700 text-white p-2 rounded"
                >
                  Save
                </button>
              </div>
            </form>
          </div>
        </div>
      );
    };

    const PlanetModal = ({ planet, onSave, onClose }) => {
      const [form, setForm] = useState(planet || {
        name: '', type: '', resources: '', sentinel: '', weather: '', outpost: 'No', notes: ''
      });

      const handleSubmit = (e) => {
        e.preventDefault();
        onSave({ ...form, id: planet?.id });
      };

      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center">
          <div className="bg-gray-800 p-6 rounded w-full max-w-md">
            <h2 className="text-xl font-bold mb-4">{planet ? 'Edit Planet' : 'Add Planet'}</h2>
            <form onSubmit={handleSubmit}>
              <input 
                type="text" 
                placeholder="Planet Name" 
                className="w-full p-2 mb-2 rounded bg-gray-700 text-white"
                value={form.name}
                onChange={(e) => setForm({ ...form, name: e.target.value })}
                required
              />
              <input 
                type="text" 
                placeholder="Type (e.g., Lush, Barren)" 
                className="w-full p-2 mb-2 rounded bg-gray-700 text-white"
                value={form.type}
                onChange={(e) => setForm({ ...form, type: e.target.value })}
                required
              />
              <input 
                type="text" 
                placeholder="Resources (e.g., Star Bulb, Copper)" 
                className="w-full p-2 mb-2 rounded bg-gray-700 text-white"
                value={form.resources}
                onChange={(e) => setForm({ ...form, resources: e.target.value })}
                required
              />
              <select 
                className="w-full p-2 mb-2 rounded bg-gray-700 text-white"
                value={form.sentinel}
                onChange={(e) => setForm({ ...form, sentinel: e.target.value })}
                required
              >
                <option value="">Select Sentinel Level</option>
                <option value="Low">Low</option>
                <option value="High">High</option>
                <option value="Aggressive">Aggressive</option>
                <option value="Corrupted">Corrupted</option>
              </select>
              <input 
                type="text" 
                placeholder="Weather (e.g., Toxic, Scalding)" 
                className="w-full p-2 mb-2 rounded bg-gray-700 text-white"
                value={form.weather}
                onChange={(e) => setForm({ ...form, weather: e.target.value })}
                required
              />
              <select 
                className="w-full p-2 mb-2 rounded bg-gray-700 text-white"
                value={form.outpost}
                onChange={(e) => setForm({ ...form, outpost: e.target.value })}
              >
                <option value="No">No</option>
                <option value="Yes">Yes</option>
              </select>
              <textarea 
                placeholder="Notes" 
                className="w-full p-2 mb-2 rounded bg-gray-700 text-white"
                value={form.notes}
                onChange={(e) => setForm({ ...form, notes: e.target.value })}
              />
              <div className="flex justify-end">
                <button 
                  type="button" 
                  className="bg-gray-600 hover:bg-gray-700 text-white p-2 rounded mr-2"
                  onClick={onClose}
                >
                  Cancel
                </button>
                <button 
                  type="submit" 
                  className="bg-blue-600 hover:bg-blue-700 text-white p-2 rounded"
                >
                  Save
                </button>
              </div>
            </form>
          </div>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>