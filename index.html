<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>NMS Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icon.png">
</head>
<body class="bg-gray-100 font-sans">
    <div class="container mx-auto p-4">
        <h1 class="text-2xl font-bold text-center mb-4">No Man's Sky Tracker</h1>

        <!-- Add System Form -->
        <div class="bg-white p-4 rounded shadow mb-4">
            <h2 class="text-xl font-semibold mb-2">Add System</h2>
            <form id="systemForm">
                <input type="text" id="systemName" placeholder="System Name" class="w-full p-2 mb-2 border rounded" required>
                <select id="race" class="w-full p-2 mb-2 border rounded">
                    <option value="Gek">Gek</option>
                    <option value="Vy'keen">Vy'keen</option>
                    <option value="Korvax">Korvax</option>
                </select>
                <input type="text" id="economyType" placeholder="Economy Type (e.g., Trading)" class="w-full p-2 mb-2 border rounded">
                <select id="economyClass" class="w-full p-2 mb-2 border rounded">
                    <option value="1-star">1-star</option>
                    <option value="2-star">2-star</option>
                    <option value="3-star">3-star</option>
                </select>
                <select id="conflictLevel" class="w-full p-2 mb-2 border rounded">
                    <option value="Low">Low</option>
                    <option value="Medium">Medium</option>
                    <option value="High">High</option>
                </select>
                <label class="flex items-center mb-2">
                    <input type="checkbox" id="pirate" class="mr-2"> Pirate System
                </label>
                <label class="flex items-center mb-2">
                    <input type="checkbox" id="dissonant" class="mr-2"> Dissonant System
                </label>
                <input type="text" id="systemCoordinates" placeholder="Galactic Coordinates (e.g., HUKYA:046A:0081:0D6D:0038)" class="w-full p-2 mb-2 border rounded">
                <button type="submit" class="w-full bg-blue-500 text-white p-2 rounded">Add System</button>
            </form>
        </div>

        <!-- Add Planet Form -->
        <div class="bg-white p-4 rounded shadow mb-4">
            <h2 class="text-xl font-semibold mb-2">Add Planet</h2>
            <form id="planetForm">
                <select id="planetSystem" class="w-full p-2 mb-2 border rounded" required></select>
                <input type="text" id="planetName" placeholder="Planet Name" class="w-full p-2 mb-2 border rounded" required>
                <input type="text" id="resources" placeholder="Resources (e.g., Paraffinium, Star Bulbs)" class="w-full p-2 mb-2 border rounded">
                <label class="flex items-center mb-2">
                    <input type="checkbox" id="outpost" class="mr-2"> Has Outpost
                </label>
                <input type="text" id="planetCoordinates" placeholder="Planetary Coordinates (e.g., +12.34/-56.78)" class="w-full p-2 mb-2 border rounded">
                <input type="text" id="biome" placeholder="Biome (e.g., Lush)" class="w-full p-2 mb-2 border rounded">
                <button type="submit" class="w-full bg-blue-500 text-white p-2 rounded">Add Planet</button>
            </form>
        </div>

        <!-- Search and Display -->
        <div class="mb-4">
            <input type="text" id="search" placeholder="Search by name, resource, or tag..." class="w-full p-2 border rounded">
        </div>
        <div id="entries" class="space-y-4"></div>
    </div>

    <script>
        // Load data from localStorage
        let systems = JSON.parse(localStorage.getItem('systems')) || [];
        let planets = JSON.parse(localStorage.getItem('planets')) || [];

        // Update system dropdown in planet form
        function updateSystemDropdown() {
            const planetSystem = document.getElementById('planetSystem');
            planetSystem.innerHTML = '<option value="">Select System</option>';
            systems.forEach(system => {
                const option = document.createElement('option');
                option.value = system.name;
                option.textContent = system.name;
                planetSystem.appendChild(option);
            });
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('systems', JSON.stringify(systems));
            localStorage.setItem('planets', JSON.stringify(planets));
            updateSystemDropdown();
            displayEntries();
        }

        // Display entries
        function displayEntries(filter = '') {
            const entriesDiv = document.getElementById('entries');
            entriesDiv.innerHTML = '';
            const lowerFilter = filter.toLowerCase();

            systems.forEach((system, index) => {
                if (system.name.toLowerCase().includes(lowerFilter) || 
                    (system.economyType && system.economyType.toLowerCase().includes(lowerFilter))) {
                    const div = document.createElement('div');
                    div.className = 'bg-white p-4 rounded shadow';
                    div.innerHTML = `
                        <h3 class="text-lg font-bold">${system.name}</h3>
                        <p>Race: ${system.race}</p>
                        <p>Economy: ${system.economyType} (${system.economyClass})</p>
                        <p>Conflict: ${system.conflictLevel}</p>
                        <p>Pirate: ${system.pirate ? 'Yes' : 'No'}</p>
                        <p>Dissonant: ${system.dissonant ? 'Yes' : 'No'}</p>
                        <p>Coordinates: ${system.coordinates}</p>
                        <button onclick="editSystem(${index})" class="text-blue-500">Edit</button>
                        <button onclick="deleteSystem(${index})" class="text-red-500 ml-2">Delete</button>
                    `;
                    entriesDiv.appendChild(div);
                }
            });

            planets.forEach((planet, index) => {
                if (planet.name.toLowerCase().includes(lowerFilter) || 
                    planet.system.toLowerCase().includes(lowerFilter) || 
                    (planet.resources && planet.resources.toLowerCase().includes(lowerFilter)) || 
                    (planet.biome && planet.biome.toLowerCase().includes(lowerFilter))) {
                    const div = document.createElement('div');
                    div.className = 'bg-white p-4 rounded shadow';
                    div.innerHTML = `
                        <h3 class="text-lg font-bold">${planet.name} (${planet.system})</h3>
                        <p>Resources: ${planet.resources}</p>
                        <p>Outpost: ${planet.outpost ? 'Yes' : 'No'}</p>
                        <p>Coordinates: ${planet.coordinates}</p>
                        <p>Biome: ${planet.biome}</p>
                        <button onclick="editPlanet(${index})" class="text-blue-500">Edit</button>
                        <button onclick="deletePlanet(${index})" class="text-red-500 ml-2">Delete</button>
                    `;
                    entriesDiv.appendChild(div);
                }
            });
        }

        // System form submission
        document.getElementById('systemForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const system = {
                name: document.getElementById('systemName').value,
                race: document.getElementById('race').value,
                economyType: document.getElementById('economyType').value,
                economyClass: document.getElementById('economyClass').value,
                conflictLevel: document.getElementById('conflictLevel').value,
                pirate: document.getElementById('pirate').checked,
                dissonant: document.getElementById('dissonant').checked,
                coordinates: document.getElementById('systemCoordinates').value
            };
            const editIndex = document.getElementById('systemForm').dataset.editIndex;
            if (editIndex) {
                systems[editIndex] = system;
                delete document.getElementById('systemForm').dataset.editIndex;
            } else {
                systems.push(system);
            }
            document.getElementById('systemForm').reset();
            saveData();
        });

        // Planet form submission
        document.getElementById('planetForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const planet = {
                system: document.getElementById('planetSystem').value,
                name: document.getElementById('planetName').value,
                resources: document.getElementById('resources').value,
                outpost: document.getElementById('outpost').checked,
                coordinates: document.getElementById('planetCoordinates').value,
                biome: document.getElementById('biome').value
            };
            const editIndex = document.getElementById('planetForm').dataset.editIndex;
            if (editIndex) {
                planets[editIndex] = planet;
                delete document.getElementById('planetForm').dataset.editIndex;
            } else {
                planets.push(planet);
            }
            document.getElementById('planetForm').reset();
            saveData();
        });

        // Edit system
        window.editSystem = function(index) {
            const system = systems[index];
            document.getElementById('systemName').value = system.name;
            document.getElementById('race').value = system.race;
            document.getElementById('economyType').value = system.economyType;
            document.getElementById('economyClass').value = system.economyClass;
            document.getElementById('conflictLevel').value = system.conflictLevel;
            document.getElementById('pirate').checked = system.pirate;
            document.getElementById('dissonant').checked = system.dissonant;
            document.getElementById('systemCoordinates').value = system.coordinates;
            document.getElementById('systemForm').dataset.editIndex = index;
        };

        // Edit planet
        window.editPlanet = function(index) {
            const planet = planets[index];
            document.getElementById('planetSystem').value = planet.system;
            document.getElementById('planetName').value = planet.name;
            document.getElementById('resources').value = planet.resources;
            document.getElementById('outpost').checked = planet.outpost;
            document.getElementById('planetCoordinates').value = planet.coordinates;
            document.getElementById('biome').value = planet.biome;
            document.getElementById('planetForm').dataset.editIndex = index;
        };

        // Delete system
        window.deleteSystem = function(index) {
            systems.splice(index, 1);
            saveData();
        };

        // Delete planet
        window.deletePlanet = function(index) {
            planets.splice(index, 1);
            saveData();
        };

        // Search functionality
        document.getElementById('search').addEventListener('input', (e) => {
            displayEntries(e.target.value);
        });

        // Initial load
        updateSystemDropdown();
        displayEntries();
    </script>
</body>
</html>